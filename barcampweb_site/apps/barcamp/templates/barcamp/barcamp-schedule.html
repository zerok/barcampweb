{% extends "barcamp/barcamp-base.html" %}
{% load i18n %}
{% block title %}{% blocktrans with barcamp.name as barcamp %}Schedule for {{ barcamp }}{% endblocktrans %}{% endblock %}
{% block submenu-barcamp-schedule %}active{% endblock %}
{% block subcontent %}
    <h2>{% trans "Talks" %}</h2>
    {% for grid in grid %}
    <h3>{{ grid.date|date:'DATE_FORMAT' }}</h3>
    <table>
        <thead>
            {% for place in grid.places %}
            <th>{{ place.name }}
                {% if is_organizer %}
                <a class="action" href="{% url barcamp:edit-place barcamp.slug, place.pk %}">{% trans "Edit" %}</a>
                {% endif %}
            
            </th>
            {% endfor %}
        </thead>
        <tbody>
            {% for row in grid.grid %}
            <tr>
                {% for elem in row %}
                <td {% if elem %}class="slot"{% endif %}>
                    {% if elem %}  
                    <span class="time">
                        {{ elem.slot.start|time:"H:i" }}-{{ elem.slot.end|time:"H:i" }}
                    </span>
                    {% for event in elem.events %}
                        <a href="{% url barcamp:event barcamp.slug,event.pk %}">{{ event.name }}</a>
                        {% if event.can_edit and user.is_authenticated %}
                        <p class="actions">
                        <a class="action action-edit" href="{% url barcamp:edit-talk barcamp.slug event.pk %}">{% trans "Edit" %}</a>
                        <a class="action action-delete" href="{% url barcamp:delete-talk barcamp.slug event.pk %}">{% trans "Remove" %}</a>
                        <a class="action action-move" href="{% url barcamp:move-talk barcamp.slug event.pk %}">{% trans "Move" %}</a>
                        <a class="action action-detach" href="{% url barcamp:detach-talk barcamp.slug event.pk %}">{% trans "Detach" %}</a>
                        </p>
                        {% endif %}
                    {% empty %}
                        {% if user.is_authenticated %}
                        <p class="actions"><a class="action action-new" href="{% url barcamp:create-talk barcamp.slug elem.slot.pk elem.place.pk %}">{% trans "Fill this slot" %}</a></p>
                        {% endif %}
                    {% endfor %}
                    {% if is_organizer %}
                    <a href="{% url barcamp:delete-slot barcamp.slug,elem.slot.pk %}" class="action action-delete">{% trans "Delete this slot" %}</a>
                    {% endif %}
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endfor %}
    
    {% if detached_talks %}
    <div id="detached-talks">
    <h2>{% trans "Unscheduled talks" %}</h2>
    <ul class="content">
        {% for talk in detached_talks %}
        <li>
            <a href="">{{ talk.name }}</a>
            {% if talk.can_edit %}
            <a class="action action-edit" href="{% url barcamp:edit-talk barcamp.slug talk.pk %}">{% trans "Edit" %}</a>
            <a class="action action-delete" href="{% url barcamp:delete-talk barcamp.slug talk.pk %}">{% trans "Remove" %}</a>
            <a class="action action-move" href="{% url barcamp:move-talk barcamp.slug talk.pk %}">{% trans "Move" %}</a>
            {% endif %}
        </li>
        {% endfor %}
    </ul>
    </div>
    {% endif %}
    
    {% if is_organizer %}
    <a id="create-slot" href="{% url barcamp:create-slot barcamp.slug %}" class="action action-new">{% trans "Create a new slot" %}</a>
    {% endif %}

    {% if sideevents %}
    <h2>{% trans "Side events" %}</h2>
    {% for day, events in sideevents %}
    <h3>{{ day|date:"DATE_FORMAT" }}</h3>
    <table>
        <thead>
            <tr>
                <th> </th>
                <th>{% trans "Start" %}</th>
                <th>{% trans "End" %}</th>
                <th>{% trans "Place" %}</th>
            </tr>
        </thead>
        <tbody>
        {% for event in events %}
            <tr>
                <td>{{ event.name }}
                    {% if is_organizer %} 
                    <a class="action action-edit" href="{% url barcamp:edit-sideevent barcamp.slug, event.pk %}">{% trans "Edit" %}</a>
                    <a class="action action-delete" href="{% url barcamp:delete-sideevent barcamp.slug, event.pk %}">{% trans "Delete" %}</a>

                    {% endif %}</td>
                <td>{{ event.start|time }}</td>
                <td>{{ event.end|time }}</td>
                <td>{{ event.place.name }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endfor %}
    {% endif %}
    {% if is_organizer %}
    <a href="{% url barcamp:create-sideevent barcamp.slug %}" class="action action-new">{% trans "Create side event" %}</a>
    {% endif %}
{% endblock %}
